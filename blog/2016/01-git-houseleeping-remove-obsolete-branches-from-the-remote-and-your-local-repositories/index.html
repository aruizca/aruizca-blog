<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>Git housekeeping: remove "obsolete" branches from the remote and your local repositories</title>

    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="keywords" content="">
    <meta name="generator" content="JBake">

    <!--Responsive Meta Tags-->
    <meta name="HandheldFriendly" content="True"/>
    <meta name="MobileOptimized" content="320"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

    <!--Bing search engine validation-->
    <meta name="msvalidate.01" content="C6990C0351F7B20ED3C944A3BB3BECD9"/>

    <!--Styles, change style.css-->
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.1.0/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="../../../vendor/bootstrap/css/bootstrap-theme.min.css" rel="stylesheet" type="text/css">
    <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='http://fonts.googleapis.com/css?family=Poly|Roboto:400,700,300|Roboto+Condensed' rel='stylesheet' type="text/css">
    <link rel="stylesheet" type="text/css" href="../../../css/style.css"/>
    <link rel="stylesheet" href="http://yandex.st/highlightjs/8.0/styles/googlecode.min.css">
    <style>
        #themecover_mobileworking_willsong {
            background: url(../../../img/background.png) repeat-y;
            background-size: 100%;
            height: 100%;
            left: 0;
            position: fixed;
            top: 30px;
            width: 100%;
            z-index: -100;
        }
    </style>

    <!--Scripts-->
    <script src="//code.jquery.com/jquery-2.1.0.min.js"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.0/js/bootstrap.min.js"></script>
    <script src="http://yandex.st/highlightjs/8.0/highlight.min.js"></script>


    <!-- Fav and touch icons -->
    <!--<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">-->
    <link rel="shortcut icon" href="../../../favicon.ico">
</head>
<div id="themecover_mobileworking_willsong"></div>
	<!-- Fixed navbar -->
    <nav id="mainnav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a id="blogname_willsong" class="navbar-brand" href="../../../">
            aruizca&#x27;s blog = brain.collect {stuff -&gt; post(stuff)}
          </a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>
<header id="indexhead_willsong">
    <div id="description_willsong" class="respowidth_willsong">
        <h3>- For anything that is worth writing in more than 140 characters -</h3>

        <h3>For everything else follow me <a href="https://twitter.com/aruizca" target="_twitter">@aruizca <i class="fa fa-twitter fa-lg"></i></a></h3>
    </div>
</header>
<section id="main_willsong" role="main">
	<article id="thearticle_willsong" class="respowidth_willsong" role="article" itemscope
			 itemtype="http://schema.org/Article">
		<h2 class="posttitle_willsong" itemprop="headline">Git housekeeping: remove "obsolete" branches from the remote and your local repositories</h2>

		<div class="articledetails_willsong">

			<i class="fa fa-clock-o fa-lg"></i><span><time class="date_willsong" datetime="31 July 2016" itemprop="datePublished">31 July 2016</time></span>
			<i class="fa fa-user fa-lg"></i><span>Angel Ruiz</span>
			<i class="fa fa-tag fa-lg"></i><span>clean, clean-up, remove, repositories, prune, local, remote, branches</span>
		</div>

		<div class="postcontent_willsong">
			<p><img src="https://aruizca.com/blog/2016/img/git-clean.png" alt="git clean"></p> 
<p>Recently I was faced with the task of cleaning up a Git repository whose branches were not "pruned" for a few years, so I am talking about several hundreds of branches.</p> 
<p>This situation can make using Git through the command line or a GUI front-end client a very cumbersome experiece. That's why I usually recommend, as a general rule, to delete any feature or bugfix branch after it gets merged to a "higher level" branch. Because they became <strong>"redundant"</strong>.</p> 
<p>The real task here is to clean up the remote branch as you can always clone the repo locally again and start from scratch. I started deleting them manually because I am not a Git guru and I am very cautius whenever I have to tempre with the remote repositorory. Soon enough I realized I was not getting anywhere and start looking for a script to help me.</p> 
<h1>Script to clean up the remote repository</h1> 
<div class="alert alert-danger" role="alert"> <i class="fa fa-exclamation-triangle" aria-hidden="true"></i> Please use it at your own risk. <i class="fa fa-exclamation-triangle" aria-hidden="true"></i> 
 <br> It worked for me using Git 2.9.2, but it should work with earlier versions. 
 <br> Although branches are removed, the metadata of the branch and the relevant commits will remain there, so it is always possible to recreate any branch that should not have been deleted. 
</div> 
<pre><code>## Remove remote branches that are already merged with master
git checkout master
# Dry-run: check the branch names list before they get deleted for good
git branch -ar --merged master | grep -v HEAD | grep -v master
# If you are really sure, then remove them from remote repo
git branch -ar --merged master | grep -v HEAD | grep -v master | sed "s/origin\///" | xargs -n 1 git push origin --delete
</code></pre> 
<h2>Breaking it down</h2> 
<pre><code>git checkout master
</code></pre> 
<ul> 
 <li>In this case I chose the master branch, but if you want to clean more recent branches you can replace all the <code>master</code> branch references with <code>develop</code> in all the commands.</li> 
</ul> 
<pre><code>git branch -ar --merged master
</code></pre> 
<ul> 
 <li>Get list of remote branches that have already been merged with the <code>master</code> branch</li> 
</ul> 
<pre><code>grep -v HEAD | grep -v master
</code></pre> 
<ul> 
 <li>Remove those items from the list that contains the words <code>HEAD</code> or <code>master</code></li> 
</ul> 
<pre><code>sed "s/origin\///"
</code></pre> 
<ul> 
 <li>For each remaining element in the list, remove the <code>origin/</code> name prefix</li> 
</ul> 
<pre><code>xargs -n 1 git push origin --delete
</code></pre> 
<ul> 
 <li>Execute the git remote branch delete command for each element in the list.</li> 
</ul> 
<h1>Script to clean up the local repository</h1> 
<div class="alert alert-danger" role="alert"> 
 <h3>Deprecated</h3> 
 <p>Just use <a href="https://github.com/tj/git-extras" target="_blank">Git Extras</a> instead (eg: `git delete-merged-branches` or `git delete-squashed-branches`</p> 
</div> 
<p>If you have been working on a repository for a while, it might be that you have local copy of a few branches that are no longer valid and need to be "pruned".</p> 
<p>To achieve that we can execute a small variation of the previous script.</p> 
<pre><code>## Remove local branches that are already merged with master

git checkout master
# Dry-run: check the branch names list before they are deleted
git branch --merged master | grep -v "master"
# If you are really sure, then remove them from local repo
git branch --merged master | grep -v "master" | xargs -n 1 git branch -d
</code></pre> 
<h3>Acknowlegment</h3> 
<p>Thanks to <a href="https://twitter.com/stevenharman">@StevenHarman</a>, whose <a href="http://stevenharman.net/git-clean-delete-already-merged-branches">post</a> showed me how to clean the local repo and gave me the idea to do same on the remote repo.</p> 
<p>Feedback and improvements are welcome!! :-)</p>
		</div>

		<div id="sharepost_willsong">
			<span>Share this post:</span><br><br>
			<a class="sharelink_willsong" target="_blank"
			   href="http://www.facebook.com/sharer.php?u={{url absolute="true"}}"><i class="fa fa-facebook fa-lg"></i></a>
			<a class="sharelink_willsong" target="_blank"
			   href="http://twitter.com/share?text={{title}}&url={{url absolute="true"}}"><i class="fa fa-twitter fa-lg"></i></a>
			<a class="sharelink_willsong" target="_blank"
			   href="https://plus.google.com/share?url={{url absolute="true"}}"><i class="fa fa-google-plus-square fa-lg"></i></a>
		</div>

<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'aruizca'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>	</article>
</section>

	

<footer>
    <!--Social Media -->
    <div id="socialmedia_willsong">
        <a href="https://twitter.com/aruizca" class="sociallink_willsong"><i class="fa fa-twitter fa-lg"></i></a>
        <a href="https://www.linkedin.com/in/angelruiz/" target="linkedin" class="sociallink_willsong"><i class="fa fa-linkedin fa-lg"></i></a>
        <a href="{{@blog.url}}/rss" target="_rss" class="sociallink_willsong"><i class="fa fa-rss fa-lg"></i></a>
    </div>

    <p id="copyright_willsong">
        <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a><br /><span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">aruizca's blog</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="http://aruizca.com" property="cc:attributionName" rel="cc:attributionURL">Angel Ruiz Calvo</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.
        <br/>
        Proudly baked with <a href="https://jbake.org/" target="_blank">JBake</a>. Look&Feel based on Wilson theme created by <a href="http://marcosn.com" target="_blank">Marcosn.com</a>
    </p>
</footer>

<script src="../../../vendor/jquery/jquery.fitvids.js"></script>
<script src="../../../vendor/jquery/jquery.appear.js"></script>
<script src="../../../js/main.js"></script>
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-41135257-3', 'aruizca.com');
    ga('require', 'linkid', 'linkid.js');
    ga('send', 'pageview');

</script>
    
