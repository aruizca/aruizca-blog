<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>Steps to create a Vagrant Base Box with Ubuntu 14.04 Desktop (GUI) and VirtualBox</title>

    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="keywords" content="">
    <meta name="generator" content="JBake">

    <!--Responsive Meta Tags-->
    <meta name="HandheldFriendly" content="True"/>
    <meta name="MobileOptimized" content="320"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

    <!--Bing search engine validation-->
    <meta name="msvalidate.01" content="C6990C0351F7B20ED3C944A3BB3BECD9"/>

    <!--Styles, change style.css-->
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.1.0/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="../../vendor/bootstrap/css/bootstrap-theme.min.css" rel="stylesheet" type="text/css">
    <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='http://fonts.googleapis.com/css?family=Poly|Roboto:400,700,300|Roboto+Condensed' rel='stylesheet' type="text/css">
    <link rel="stylesheet" type="text/css" href="../../css/style.css"/>
    <link rel="stylesheet" href="http://yandex.st/highlightjs/8.0/styles/googlecode.min.css">
    <style>
        #themecover_mobileworking_willsong {
            background: url(../../img/background.png) repeat-y;
            background-size: 100%;
            height: 100%;
            left: 0;
            position: fixed;
            top: 30px;
            width: 100%;
            z-index: -100;
        }
    </style>

    <!--Scripts-->
    <script src="//code.jquery.com/jquery-2.1.0.min.js"></script>
    <script src="//netdna.bootstrapcdn.com/bootstrap/3.1.0/js/bootstrap.min.js"></script>
    <script src="http://yandex.st/highlightjs/8.0/highlight.min.js"></script>


    <!-- Fav and touch icons -->
    <!--<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">-->
    <link rel="shortcut icon" href="../../favicon.ico">
</head>
<div id="themecover_mobileworking_willsong"></div>
	<!-- Fixed navbar -->
    <nav id="mainnav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a id="blogname_willsong" class="navbar-brand" href="../../">
            aruizca&#x27;s blog = brain.collect {stuff -&gt; post(stuff)}
          </a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>
<header id="indexhead_willsong">
    <div id="description_willsong" class="respowidth_willsong">
        <h3>- For anything that is worth writing in more than 140 characters -</h3>

        <h3>For everything else follow me <a href="https://twitter.com/aruizca" target="_twitter">@aruizca <i class="fa fa-twitter fa-lg"></i></a></h3>
    </div>
</header>
<section id="main_willsong" role="main">
	<article id="thearticle_willsong" class="respowidth_willsong" role="article" itemscope
			 itemtype="http://schema.org/Article">
		<h2 class="posttitle_willsong" itemprop="headline">Steps to create a Vagrant Base Box with Ubuntu 14.04 Desktop (GUI) and VirtualBox</h2>

		<div class="articledetails_willsong">

			<i class="fa fa-clock-o fa-lg"></i><span><time class="date_willsong" datetime="23 May 2014" itemprop="datePublished">23 May 2014</time></span>
			<i class="fa fa-user fa-lg"></i><span>Angel Ruiz</span>
			<i class="fa fa-tag fa-lg"></i><span>vagrant, ubuntu, devops, virtualization, virtualbox</span>
		</div>

		<div class="postcontent_willsong">
			<p><img src="blog/2014/img/vagrant-virtualbox-ubuntu-post-title.png" alt="Vagrant + VirtualBox + Ubuntu = Ubuntu Boxes"></p> 
<p>Since the advent of the <a href="http://en.wikipedia.org/wiki/Cloud_computing#Infrastructure_as_a_service_.28IaaS.29" title="Infrastructure as a Service" target="_blank">IaaS</a> and <a href="http://en.wikipedia.org/wiki/Platform_as_a_service" title="Platform as a Service" target="_blank">PaaS</a> providers, the decline in usage of monolithic architectures (e.g.: application server + relational DB) and the need for distributed and automatically scalable applications, as software developers we have to be increasingly more aware and skilled in the tools and techniques used to orchestrate and automate the deployment of all the different components that our architecture might end up with.</p> 
<p>Among these tools, normally encompassed in the DevOps space, I am currently very interested in <a href="http://www.vagrantup.com/" title="Vagrant Website" target="_blank"><strong>Vagrant</strong></a>, <a href="https://www.docker.io/" title="Docker Website" target="_blank"><strong>Docker</strong></a>, <a href="http://www.ansible.com" title="Ansible Website" target="_blank"><strong>Ansible</strong></a> and <a href="https://juju.ubuntu.com/" title="Ubuntu JuJu Website" target="_blank"><strong>Ubuntu JuJu</strong></a>. Although I already use Vagrant, today I decided I wanted to know how to create my own <a href="http://docs.vagrantup.com/v2/boxes/base.html" title="What is a Vagrant Base Box?" target="_blank"><strong>Base Boxes</strong></a> that I can reuse. My idea is to have two Linux Base Boxes with Ubuntu Server and Ubuntu Desktop respectively and then another two with Windows 7 and 8. Once Vagrant is covered I want to get deeper with Docker because I see a lot of potential in lightweight containers instead of using heavy virtual machines.</p> 
<p>Most of the guides out there focus on Linux distributions without GUI, so I decided that while I am creating my Vagrant Base Box with Ubuntu 14.04 Desktop I would document all the relevant steps next:</p> 
<hr> 
<h2>Step 1: Create the Virtual Machine with Virtual Box</h2> 
<h3>- Install VirtualBox</h3> 
<p>Download relevant VirtualBox installable package for your host system from the website: <a href="https://www.virtualbox.org/">https://www.virtualbox.org/</a></p> 
<h3>- Download Ubuntu ISO</h3> 
<p>I have downloaded the 64bit Desktop ISO: <a href="http://www.ubuntu.com/download/desktop">http://www.ubuntu.com/download/desktop</a></p> 
<h3>- Define your Virtual Machine taking into consideration that:</h3> 
<ol> 
 <li>The first network interface (adapter 1) must be a NAT adapter.</li> 
 <li>For convenience the Virtual Disk should be Dynamic (<strong>VMDK</strong>), so don't bee too stingy with the disk size ( &gt;= 10GB IMO ).</li> 
</ol> 
<p><img src="blog/2014/img/virtualbox-settings.png" alt="VirtualBox settings"></p> 
<h3>- Load the ISO as part of the VM storage and install the OS.</h3> 
<h3>- Username and Password should be: <strong>vagrant</strong> (for convenience, not for security).</h3> 
<h3>- Once installed unload the ISO and restart the VM.</h3> 
<h3>- Install the <strong>"Guest Additions"</strong></h3> 
<p>Before installing the Guest Additions, you will have to prepare your guest system for building external kernel modules:</p> 
<pre><code>	$ sudo apt-get install dkms
	$ sudo /etc/init.d/vboxadd setup
</code></pre> 
<p>and install the build-essential package and linux headers to compile the Guest Additions propertly</p> 
<pre><code>	$ sudo apt-get install -y build-essential linux-headers-server
</code></pre> 
<p>Then Mount guest additions ISO via virtualbox window and follow the indications to run the installation script :</p> 
<p><img src="blog/2014/img/vitualbox-guest-addtions.png" alt="VirtualBox Guest Additions"></p> 
<p>If the sytems does not install it automatically you can use the following commands:</p> 
<pre><code>	$ sudo mount /dev/cdrom /media/cdrom
	$ sudo /media/cdrom/VBoxLinuxAdditions.run
	$ sudo umount /media/cdrom
	$ sudo apt-get clean
</code></pre> 
<h2>Step 2: Setup guest OS (Ubuntu 14.04 64bit) with the minimum necessary.</h2> 
<h3>- Use "Software Updater" to get latest updates. Or if you are using the command line:</h3> 
<pre><code>	$ sudo apt-get update -y
	$ sudo apt-get upgrade -y
	# Restart the machine
	$ sudo shutdown -r now
</code></pre> 
<h3>- Add the <strong>vagrant</strong> user to sudoers file:</h3> 
<pre><code>	$ sudo su -
	$ visudo
	# Add the following line to the end of the file.
	vagrant ALL=(ALL) NOPASSWD:ALL
</code></pre> 
<h3>- Install Vagrant Public Keys</h3> 
<p>This way we can SSH to the machine without entering the password:</p> 
<pre><code>	$ mkdir -p /home/vagrant/.ssh
	$ wget --no-check-certificate https://raw.github.com/mitchellh/vagrant/master/keys/vagrant.pub -O /home/vagrant/.ssh/authorized_keys
	# Ensure we have the correct permissions set
	$ chmod 0700 /home/vagrant/.ssh
	$ chmod 0600 /home/vagrant/.ssh/authorized_keys
	$ chown -R vagrant /home/vagrant/.ssh
</code></pre> 
<h3>Install OpenSSH Server</h3> 
<pre><code>	$ sudo apt-get install -y openssh-server
	$ sudo vi /etc/ssh/sshd_config
</code></pre> 
<p>Ensure the following is set:</p> 
<ul> 
 <li>Port 22</li> 
 <li>PubKeyAuthentication yes</li> 
 <li>AuthorizedKeysFile %h/.ssh/authorized_keys</li> 
 <li>PermitEmptyPasswords no</li> 
</ul> 
<pre><code>	$ sudo service ssh restart
</code></pre> 
<p>Save &amp; close the file then restart SSH.</p> 
<h2>Step 3: Package the Box</h2> 
<h3>Compact space and shut the VM down</h3> 
<p>You can remove those packages that you don't consider necessary (e.g.: LibreOffice) and execute the following commands to save space and shut the VM down:</p> 
<pre><code>	$ sudo dd if=/dev/zero of=/EMPTY bs=1M
	$ sudo rm -f /EMPTY
	# Shutdown the machine
	$ sudo shutdown -h now
</code></pre> 
<h3>Create Vagrant Base Box</h3> 
<p>Asuming you already have Vagrant installed in the host system, just run the following command:</p> 
<pre><code>	$ vagrant package –-base &lt;VitualBox VM Name&gt;
</code></pre> 
<p>in my case:</p> 
<pre><code>	$ vagrant package –-base Ubuntu-14.04-64-Desktop
</code></pre> 
<p>this will create a file called <strong>package.box</strong></p> 
<h3>Install the box</h3> 
<pre><code>	$ vagrant box add {boxname} package.box
</code></pre> 
<p>in my case:</p> 
<pre><code>	$ vagrant box add Ubuntu-14.04-64-Desktop package.box
</code></pre> 
<h3>Init a Vagrant Box by referencing the Base one we have created</h3> 
<p>Go to a different folder and type:</p> 
<pre><code>	$ vagrant init {boxname}
</code></pre> 
<p>in my case:</p> 
<pre><code>	$ vagrant init Ubuntu-14.04-64-Desktop
</code></pre> 
<h3>Enable GUI</h3> 
<p>Edit the generated <strong>Vagrantfile</strong> by uncommenting the following lines:</p> 
<pre><code>	config.vm.provider "virtualbox" do |v|
	v.gui = true
	end
</code></pre> 
<h3>Spin it up!</h3> 
<pre><code>	$ vagrant up
</code></pre> 
<p>and you should be able to SSH the machine and see the VM running:</p> 
<p><img src="blog/2014/img/vagrant-box-running.png" alt="VirtualBox Guest Running"></p> 
<p>Please let me know if you find something that is incorrect or inaccurate.</p> 
<p>Cheers.</p>
		</div>

		<div id="sharepost_willsong">
			<span>Share this post:</span><br><br>
			<a class="sharelink_willsong" target="_blank"
			   href="http://www.facebook.com/sharer.php?u={{url absolute="true"}}"><i class="fa fa-facebook fa-lg"></i></a>
			<a class="sharelink_willsong" target="_blank"
			   href="http://twitter.com/share?text={{title}}&url={{url absolute="true"}}"><i class="fa fa-twitter fa-lg"></i></a>
			<a class="sharelink_willsong" target="_blank"
			   href="https://plus.google.com/share?url={{url absolute="true"}}"><i class="fa fa-google-plus-square fa-lg"></i></a>
		</div>

<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'aruizca'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>	</article>
</section>

	

<footer>
    <!--Social Media -->
    <div id="socialmedia_willsong">
        <a href="https://twitter.com/aruizca" class="sociallink_willsong"><i class="fa fa-twitter fa-lg"></i></a>
        <a href="https://plus.google.com/u/0/+ÁngelRuiz" class="sociallink_willsong"><i class="fa fa-google-plus-square fa-lg"></i></a>
        <a href="http://au.linkedin.com/in/angelruiz/" target="linkedin" class="sociallink_willsong"><i class="fa fa-linkedin fa-lg"></i></a>
        <a href="{{@blog.url}}/rss" target="_rss" class="sociallink_willsong"><i class="fa fa-rss fa-lg"></i></a>
    </div>

    <p id="copyright_willsong">
        <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-sa/4.0/88x31.png" /></a><br /><span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">aruizca's blog</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="http://aruizca.com" property="cc:attributionName" rel="cc:attributionURL">Angel Ruiz Calvo</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.
        <br/>
        Prowdly powered by <a href="http://ghost.org" target="_blank">Ghost</a>. Look&Feel based on Wilson theme created by <a href="http://marcosn.com" target="_blank">Marcosn.com</a>
    </p>
</footer>

<script src="../../vendor/jquery/jquery.fitvids.js"></script>
<script src="../../vendor/jquery/jquery.appear.js"></script>
<script src="../../js/main.js"></script>
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-41135257-3', 'aruizca.com');
    ga('require', 'linkid', 'linkid.js');
    ga('send', 'pageview');

</script>
    
